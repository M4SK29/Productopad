# Imports import board import busio import digitalio from kmk.kmk_keyboard import KMKKeyboard from kmk.scanners.keypad import KeysScanner from kmk.keys import KC from kmk.modules.macros import Press, Release, Tap, Macros from kmk.modules import Module # OLED imports from adafruit_ssd1306 import SSD1306_I2C # Initialize I2C and OLED i2c = busio.I2C(scl=board.GP7, sda=board.GP6) oled = SSD1306_I2C(128, 64, i2c) # adjust resolution if needed oled.fill(0) oled.show() def show_message(msg): oled.fill(0) oled.text(msg, 0, 0) oled.show() # Optional LED led = digitalio.DigitalInOut(board.GP29) led.direction = digitalio.Direction.OUTPUT # Initialize KMK keyboard keyboard = KMKKeyboard() # Macro module macros = Macros() keyboard.modules.append(macros) # Pins for 4 keys PINS = [board.GP1, board.GP2, board.GP3, board.GP4] keyboard.matrix = KeysScanner( pins=PINS, value_when_pressed=False, # True if buttons pull HIGH ) # Shortcuts and corresponding OLED messages shortcuts = [ (KC.W, "WhatsApp"), (KC.C, "Chrome"), (KC.X, "Calculator"), (KC.G, "ChatGPT"), ] # Track toggle state for each key key_toggle_state = [False] * 4 class ToggleModule(Module): def on_key_press(self, keyboard, key, is_pressed): if not is_pressed: # Find which key try: idx = keyboard.matrix.pins.index(key.pin) except AttributeError: return except ValueError: return kc, msg = shortcuts[idx] if not key_toggle_state[idx]: # First press → show OLED show_message(msg) led.value = True # turn on LED briefly key_toggle_state[idx] = True else: # Second press → send shortcut macros_list = [ Press(KC.LCTRL), Press(KC.LALT), Press(KC.LSHIFT), Tap(kc), Release(KC.LSHIFT), Release(KC.LALT), Release(KC.LCTRL), ] for action in macros_list: action.execute(keyboard) led.value = False # turn off LED key_toggle_state[idx] = False # reset toggle # Attach module keyboard.modules.append(ToggleModule()) # Dummy keymap placeholders (real behavior handled by ToggleModule) keyboard.keymap = [ [KC.A, KC.DELETE, KC.MACRO(""), KC.Macro("")] ] # Start KMK if __name__ == "__main__": keyboard.go()